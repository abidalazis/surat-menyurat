<style>
    /* ================================================================
     * FORM INPUT STYLES
     * ================================================================ */
    .input-container {
      max-width: 800px;
      margin: 0 auto;
    }
    
    .mode-selector {
      display: flex;
      gap: 15px;
      margin-bottom: 30px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 10px;
    }
    
    .mode-option {
      flex: 1;
      padding: 20px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      background: white;
      user-select: none;
      -webkit-user-select: none;
    }
    
    .mode-option:hover {
      border-color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
    }
    
    .mode-option.active {
      border-color: #667eea;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .mode-icon {
      font-size: 48px;
      margin-bottom: 10px;
    }
    
    .mode-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .mode-desc {
      font-size: 13px;
      opacity: 0.8;
    }
    
    .form-card {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      margin-bottom: 20px;
    }
    
    .form-section {
      margin-bottom: 30px;
    }
    
    .section-title {
      font-size: 16px;
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f0f0;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #495057;
      font-weight: 500;
      font-size: 14px;
    }
    
    .form-group label .required {
      color: #e74c3c;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s ease;
      font-family: inherit;
      box-sizing: border-box;
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    .form-group .hint {
      font-size: 12px;
      color: #7f8c8d;
      margin-top: 5px;
    }
    
    .preview-box {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 25px;
      border-radius: 12px;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .preview-label {
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 10px;
    }
    
    .preview-nomor {
      font-size: 28px;
      font-weight: 700;
      letter-spacing: 1px;
      margin-bottom: 10px;
      font-family: 'Courier New', monospace;
    }
    
    .preview-detail {
      font-size: 13px;
      opacity: 0.8;
    }
    
    .form-actions {
      display: flex;
      gap: 15px;
      margin-top: 30px;
    }
    
    .btn {
      padding: 12px 30px;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      flex: 1;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }
    
    .btn-secondary {
      background: #6c757d;
      color: white;
    }
    
    .btn-secondary:hover {
      background: #5a6268;
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }
    
    .checkbox-option {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      margin-top: 15px;
    }
    
    .checkbox-option input[type="checkbox"] {
      width: auto;
      margin: 0;
    }
    
    .checkbox-option label {
      margin: 0;
      font-weight: normal;
      cursor: pointer;
    }
    
    .alert {
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
      animation: slideDown 0.3s ease-out;
    }
    
    .alert.show {
      display: block;
    }
    
    .alert-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .alert-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .alert-info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .hidden {
      display: none !important;
    }
    
    /* Loading spinner */
    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  
  <div class="input-container">
    
    <!-- Alert message -->
    <div id="alert" class="alert"></div>
    
    <!-- Mode selector -->
    <div class="mode-selector">
      <div class="mode-option active" id="mode-srikandi" onclick="selectMode('srikandi')">
        <div class="mode-icon">üìã</div>
        <div class="mode-title">Dari Srikandi</div>
        <div class="mode-desc">Input nomor yang sudah ada</div>
      </div>
      
      <div class="mode-option" id="mode-manual" onclick="selectMode('manual')">
        <div class="mode-icon">‚ö°</div>
        <div class="mode-title">Manual (Auto-Generate)</div>
        <div class="mode-desc">Sistem generate nomor otomatis</div>
      </div>
    </div>
    
    <!-- Form -->
    <form id="formInput" onsubmit="handleSubmit(event)">
      
      <!-- SECTION: Nomor Surat -->
      <div class="form-card">
        <div class="form-section">
          <div class="section-title">
            <span>üî¢</span>
            <span>Nomor Surat</span>
          </div>
          
          <!-- Mode Srikandi -->
          <div id="section-srikandi" class="mode-section">
            <div class="form-group">
              <label>Nomor Surat Lengkap <span class="required">*</span></label>
              <input 
                type="text" 
                id="nomorLengkap" 
                placeholder="Contoh: 100.1.2/046/405.29.05/2025"
                oninput="validateNomorSurat()"
              >
              <div class="hint">üí° Paste nomor lengkap dari sistem Srikandi</div>
            </div>
          </div>
          
          <!-- Mode Manual -->
          <div id="section-manual" class="mode-section hidden">
            <div class="form-row">
              <div class="form-group">
                <label>Kode Klasifikasi Depan <span class="required">*</span></label>
                <input 
                  type="text" 
                  id="kodeDepan" 
                  placeholder="Contoh: 100.1.2"
                  oninput="updatePreview()"
                  list="kodeDepanList"
                >
                <datalist id="kodeDepanList"></datalist>
                <div class="hint">Format: XXX.X.X</div>
              </div>
              
              <div class="form-group">
                <label>Kode Klasifikasi Belakang</label>
                <input 
                  type="text" 
                  id="kodeBelakang" 
                  value="405.29.05"
                  placeholder="Default: 405.29.05"
                  oninput="updatePreview()"
                >
                <div class="hint">Default: 405.29.05 (bisa diubah)</div>
              </div>
            </div>
            
            <!-- Preview nomor -->
            <div class="preview-box" id="previewBox">
              <div class="preview-label">üîç PREVIEW NOMOR YANG AKAN DI-GENERATE:</div>
              <div class="preview-nomor" id="previewNomor">-</div>
              <div class="preview-detail" id="previewDetail">Isi kode klasifikasi untuk melihat preview</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- SECTION: Data Surat -->
      <div class="form-card">
        <div class="form-section">
          <div class="section-title">
            <span>üìù</span>
            <span>Data Surat</span>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>Tanggal Surat <span class="required">*</span></label>
              <input 
                type="date" 
                id="tanggalSurat" 
              >
            </div>
            
            <div class="form-group">
              <label>Bidang <span class="required">*</span></label>
              <input 
                type="text" 
                id="bidang" 
                value="<?= user.bidang ?>"
                readonly
                style="background: #f8f9fa;"
              >
              <div class="hint">Otomatis dari akun Anda</div>
            </div>
          </div>
          
          <div class="form-group">
            <label>Perihal Surat <span class="required">*</span></label>
            <input 
              type="text" 
              id="perihal" 
              placeholder="Masukkan perihal surat"
            >
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>Jenis Surat <span class="required">*</span></label>
              <select id="jenisSurat">
                <option value="">-- Pilih Jenis --</option>
                <option value="Surat Keputusan (SK)">Surat Keputusan (SK)</option>
                <option value="Surat Tugas">Surat Tugas</option>
                <option value="Surat Undangan">Surat Undangan</option>
                <option value="Surat Edaran">Surat Edaran</option>
                <option value="Surat Keterangan">Surat Keterangan</option>
                <option value="Surat Pemberitahuan">Surat Pemberitahuan</option>
                <option value="Memo">Memo</option>
                <option value="Nota Dinas">Nota Dinas</option>
                <option value="Surat Permohonan">Surat Permohonan</option>
                <option value="Lainnya">Lainnya</option>
              </select>
            </div>
            
            <div class="form-group">
              <label>Tujuan Surat</label>
              <input 
                type="text" 
                id="tujuan" 
                placeholder="Contoh: Internal / Eksternal / Nama penerima"
              >
            </div>
          </div>
          
          <div class="form-group">
            <label>Keterangan</label>
            <textarea 
              id="keterangan" 
              placeholder="Catatan tambahan (opsional)"
            ></textarea>
          </div>
        </div>
      </div>
      
      <!-- Quick Add Option -->
      <div class="checkbox-option">
        <input type="checkbox" id="quickAdd">
        <label for="quickAdd">
          ‚ö° <strong>Quick Add:</strong> Input surat lagi dengan data yang sama setelah submit
        </label>
      </div>
      
      <!-- Form Actions -->
      <div class="form-actions">
        <button type="button" class="btn btn-secondary" onclick="resetForm()">
          üîÑ Reset
        </button>
        <button type="submit" class="btn btn-primary" id="btnSubmit">
          <span id="btnText">üíæ Simpan Surat</span>
          <span class="spinner hidden" id="btnSpinner"></span>
        </button>

      </div>
      
      <!-- Hidden ID for Edit Mode -->
      <input type="hidden" id="editId" value="">
    </form>
  </div>
  
  <script>
    // ================================================================
    // GLOBAL VARIABLES
    // ================================================================
    let currentMode = 'srikandi';
    
    // Get data from parent container (tab-input)
    const tabInput = document.getElementById('tab-input') || 
                     document.querySelector('[data-session-id]') ||
                     document.currentScript.closest('[data-session-id]');
    
    let sessionId = '';
    let userBidang = 'Sekretariat';
    let nomorAgendaTerakhir = 0;
    
    // Try multiple ways to get session ID
    if (tabInput) {
      sessionId = tabInput.getAttribute('data-session-id') || '';
      userBidang = tabInput.getAttribute('data-user-bidang') || 'Sekretariat';
      const nomorStr = tabInput.getAttribute('data-nomor-terakhir') || '0';
      nomorAgendaTerakhir = parseInt(nomorStr.replace(/^0+/, '')) || 0;
      console.log('Got data from data attributes');
    }
    
    // Fallback: try from window/parent
    if (!sessionId || sessionId === 'undefined') {
      if (typeof window.SESSION_ID !== 'undefined') {
        sessionId = window.SESSION_ID;
        console.log('Got session from window.SESSION_ID');
      } else if (typeof parent.SESSION_ID !== 'undefined') {
        sessionId = parent.SESSION_ID;
        console.log('Got session from parent.SESSION_ID');
      } else {
        // Last resort: get from URL
        const urlParams = new URLSearchParams(window.location.search);
        sessionId = urlParams.get('session') || '';
        console.log('Got session from URL params');
      }
    }
    
    const currentYear = new Date().getFullYear();
    
    console.log('=== Form Initialization ===');
    console.log('Nomor terakhir:', nomorAgendaTerakhir);
    console.log('User bidang:', userBidang);
    console.log('Session ID:', sessionId);
    console.log('Session ID length:', sessionId ? sessionId.length : 0);
    
    // Validate session ID
    if (!sessionId || sessionId === 'undefined' || sessionId.includes('<?=')) {
      console.error('‚ùå Session ID not valid!');
      console.error('Session ID value:', sessionId);
      
      // Show error immediately
      setTimeout(() => {
        const alert = document.getElementById('alert');
        if (alert) {
          alert.textContent = '‚ö†Ô∏è Session tidak valid. Silakan refresh halaman atau login kembali.';
          alert.className = 'alert alert-error show';
        }
      }, 100);
    } else {
      console.log('‚úì Session ID valid');
    }
    
    // ================================================================
    // MODE SELECTION
    // ================================================================
    function selectMode(mode) {
      console.log('selectMode called with:', mode);
      currentMode = mode;
      
      // Update UI
      const srikandi = document.getElementById('mode-srikandi');
      const manual = document.getElementById('mode-manual');
      
      if (srikandi && manual) {
        srikandi.classList.remove('active');
        manual.classList.remove('active');
        document.getElementById('mode-' + mode).classList.add('active');
      }
      
      // Show/hide sections
      const sectionSrikandi = document.getElementById('section-srikandi');
      const sectionManual = document.getElementById('section-manual');
      const nomorLengkap = document.getElementById('nomorLengkap');
      const kodeDepan = document.getElementById('kodeDepan');
      
      if (mode === 'srikandi') {
        if (sectionSrikandi) sectionSrikandi.classList.remove('hidden');
        if (sectionManual) sectionManual.classList.add('hidden');
      } else {
        if (sectionSrikandi) sectionSrikandi.classList.add('hidden');
        if (sectionManual) sectionManual.classList.remove('hidden');
        updatePreview();
      }
    }
    
    // Make selectMode available globally
    window.selectMode = selectMode;
    
    // ================================================================
    // PREVIEW NOMOR (MODE MANUAL)
    // ================================================================
    function updatePreview() {
      const kodeDepan = document.getElementById('kodeDepan').value.trim();
      const kodeBelakang = document.getElementById('kodeBelakang').value.trim() || '405.29.05';
      
      const previewBox = document.getElementById('previewNomor');
      const previewDetail = document.getElementById('previewDetail');
      
      if (kodeDepan) {
        const nomorBaru = parseInt(nomorAgendaTerakhir) + 1;
        const nomorFormatted = String(nomorBaru).padStart(3, '0');
        const nomorLengkap = `${kodeDepan}/${nomorFormatted}/${kodeBelakang}/${currentYear}`;
        
        previewBox.textContent = nomorLengkap;
        previewDetail.innerHTML = `
          Nomor Agenda: <strong>${nomorFormatted}</strong> (auto) | 
          Nomor Terakhir: ${String(nomorAgendaTerakhir).padStart(3, '0')} |
          Tahun: ${currentYear}
        `;
      } else {
        previewBox.textContent = '-';
        previewDetail.textContent = 'Isi kode klasifikasi untuk melihat preview';
      }
    }
    
    // ================================================================
    // VALIDATE NOMOR SURAT (MODE SRIKANDI)
    // ================================================================
    function validateNomorSurat() {
      const nomor = document.getElementById('nomorLengkap');
      if (nomor && nomor.value.trim() && nomor.value.includes('/')) {
        showAlert('‚úì Format nomor terdeteksi', 'info', 2000);
      }
    }
    
    // Make available globally
    window.validateNomorSurat = validateNomorSurat;
    
    // ================================================================
    // FORM SUBMIT
    // ================================================================
    function handleSubmit(event) {
      event.preventDefault();
      console.log('handleSubmit called');
      
      // Collect form data
      const formData = {
        mode: currentMode,
        nomorLengkap: document.getElementById('nomorLengkap').value.trim(),
        kodeDepan: document.getElementById('kodeDepan').value.trim(),
        kodeBelakang: document.getElementById('kodeBelakang').value.trim() || '405.29.05',
        tanggalSurat: document.getElementById('tanggalSurat').value,
        bidang: userBidang,
        perihal: document.getElementById('perihal').value.trim(),
        jenisSurat: document.getElementById('jenisSurat').value,
        tujuan: document.getElementById('tujuan').value.trim(),
        keterangan: document.getElementById('keterangan').value.trim(),
        tujuan: document.getElementById('tujuan').value.trim(),
        keterangan: document.getElementById('keterangan').value.trim(),
        sessionId: sessionId,
        id: document.getElementById('editId').value // Add ID for edit mode
      };
      
      console.log('Form data:', formData);
      
      // Validate
      if (currentMode === 'srikandi' && !formData.nomorLengkap) {
        showAlert('‚ùå Nomor surat lengkap harus diisi', 'error');
        return;
      }
      
      if (currentMode === 'manual' && !formData.kodeDepan) {
        showAlert('‚ùå Kode klasifikasi depan harus diisi', 'error');
        return;
      }
      
      if (!formData.perihal) {
        showAlert('‚ùå Perihal harus diisi', 'error');
        return;
      }
      
      if (!formData.jenisSurat) {
        showAlert('‚ùå Jenis surat harus dipilih', 'error');
        return;
      }
      
      // Show loading
      setLoading(true);
      
      // Submit via google.script.run
      if (typeof google !== 'undefined' && google.script && google.script.run) {
        console.log('Submitting via google.script.run...');
        google.script.run
          .withSuccessHandler(handleSubmitSuccess)
          .withFailureHandler(handleSubmitError)
          .submitSurat(formData);
      } else {
        setLoading(false);
        showAlert('‚ùå Error: google.script.run tidak tersedia', 'error');
        console.error('google.script.run not available');
      }
    }
    
    // Make available globally
    window.handleSubmit = handleSubmit;
    
    function handleSubmitSuccess(response) {
      console.log('Submit success response:', response);
      setLoading(false);
      
      if (response && response.success) {
        showAlert('‚úÖ ' + response.message, 'success');
        
        // Update nomor terakhir
        if (response.nomorAgenda) {
          nomorAgendaTerakhir = response.nomorAgenda;
          updatePreview();
        }
        
        // Quick add?
        const quickAdd = document.getElementById('quickAdd').checked;
        if (quickAdd) {
          // Reset only perihal, tujuan, keterangan
          document.getElementById('perihal').value = '';
          document.getElementById('tujuan').value = '';
          document.getElementById('keterangan').value = '';
          document.getElementById('nomorLengkap').value = '';
          document.getElementById('perihal').focus();
          
          showAlert('‚úì Data tersimpan! Siap input surat berikutnya', 'info', 3000);
        } else {
          // Reset all
          setTimeout(() => {
            // Check if we are in Edit mode, if so, don't fully reset, maybe redirect?
            // For now, standard behavior: reset form
            resetForm();
            
            // If it was an edit, change button text back to Simpan
            if (document.getElementById('editId').value) {
                document.getElementById('editId').value = '';
                document.getElementById('btnText').textContent = 'üíæ Simpan Surat';
            }
            
            showAlert('‚úì Surat berhasil disimpan!', 'success', 3000);
          }, 2000);
        }
      } else {
        const errorMsg = response ? response.message : 'Response tidak valid';
        showAlert('‚ùå ' + errorMsg, 'error');
        console.error('Submit failed:', response);
      }
    }
    
    function handleSubmitError(error) {
      console.error('Submit error:', error);
      setLoading(false);
      showAlert('‚ùå Error: ' + error.message, 'error');
    }
    
    // ================================================================
    // UI HELPERS
    // ================================================================
    function setLoading(isLoading) {
      const btn = document.getElementById('btnSubmit');
      const btnText = document.getElementById('btnText');
      const btnSpinner = document.getElementById('btnSpinner');
      
      btn.disabled = isLoading;
      
      if (isLoading) {
        btnText.classList.add('hidden');
        btnSpinner.classList.remove('hidden');
      } else {
        btnText.classList.remove('hidden');
        btnSpinner.classList.add('hidden');
      }
    }
    
    function showAlert(message, type, duration) {
      const alert = document.getElementById('alert');
      alert.textContent = message;
      alert.className = 'alert alert-' + type + ' show';
      
      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
      
      if (duration) {
        setTimeout(() => {
          alert.classList.remove('show');
        }, duration);
      }
    }
    
    function resetForm() {
      console.log('resetForm called');
      const form = document.getElementById('formInput');
      if (form) {
        form.reset();
        document.getElementById('nomorLengkap').value = '';
        document.getElementById('kodeDepan').value = '';
        document.getElementById('kodeBelakang').value = '405.29.05';
        document.getElementById('bidang').value = userBidang;
        document.getElementById('tanggalSurat').value = '';
        document.getElementById('quickAdd').checked = false;
        
        updatePreview();
        
        // Hide alert
        const alert = document.getElementById('alert');
        if (alert) alert.classList.remove('show');
    // Reset Edit Mode
        if (document.getElementById('editId')) document.getElementById('editId').value = '';
        if (document.getElementById('btnText')) document.getElementById('btnText').textContent = 'üíæ Simpan Surat';
        // Use selectMode to ensure required attributes are correctly toggled
        selectMode('srikandi');
      }
    }
    
    // ================================================================
    // EDIT MODE HANDLER
    // ================================================================
    function loadSuratForEdit(data) {
      console.log('loadSuratForEdit called with:', data);
      
      if (!data) return;
      
      // Select Mode based on data
      const mode = (data.sumber === 'Manual') ? 'manual' : 'srikandi';
      selectMode(mode);
      
      // Set values
      document.getElementById('editId').value = data.id || '';
      document.getElementById('tanggalSurat').value = data.tanggalIso || ''; // Assuming backend sends ISO YYYY-MM-DD
      document.getElementById('bidang').value = data.bidang || '';
      document.getElementById('perihal').value = data.perihal || '';
      document.getElementById('jenisSurat').value = data.jenis || '';
      document.getElementById('tujuan').value = data.tujuan || '';
      document.getElementById('keterangan').value = data.keterangan || '';
      
      // Set Mode Specifics
      if (mode === 'srikandi') {
        document.getElementById('nomorLengkap').value = data.nomor || '';
      } else {
        // Manual
        // Try to parse kode depan/belakang from nomor if possible, 
        // OR just set text fields if we save them separately (we do: kodeDepan, kodeBelakang)
        if (data.kodeDepan) document.getElementById('kodeDepan').value = data.kodeDepan;
        if (data.kodeBelakang) document.getElementById('kodeBelakang').value = data.kodeBelakang;
        updatePreview();
      }
      
      // Update UI for Edit
      document.getElementById('btnText').textContent = 'üíæ Update Surat';
      
      showAlert('‚úèÔ∏è Mode Edit: Silakan ubah data dan simpan', 'info', 3000);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    // Make available globally
    window.resetForm = resetForm;
    window.updatePreview = updatePreview;
    window.loadSuratForEdit = loadSuratForEdit;
    
    // ================================================================
    // INIT
    // ================================================================
    window.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded, initializing form...');
      
      // Set today's date
      const today = new Date().toISOString().split('T')[0];
      const tanggalSurat = document.getElementById('tanggalSurat');
      if (tanggalSurat) {
        tanggalSurat.value = today;
      }
      
      // Set bidang
      const bidangField = document.getElementById('bidang');
      if (bidangField) {
        bidangField.value = userBidang;
      }
      
      // Update preview
      updatePreview();
      
      console.log('Form initialized successfully');
    });
  </script>
  
